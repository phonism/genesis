<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A lightweight deep learning framework built from scratch with Python + Triton + CUDA"><meta name=author content="Genesis Team"><link href=https://phonism.github.io/genesis/en/memory-allocator-optimization/ rel=canonical><link href=../architecture/ rel=prev><link href=../models/qwen/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.16"><title>Memory Allocator Optimization - Genesis Deep Learning Framework</title><link rel=stylesheet href=../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../shared/stylesheets/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config",""),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#genesis-gpu-memory-allocator-performance-optimization-journey class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Genesis Deep Learning Framework" class="md-header__button md-logo" aria-label="Genesis Deep Learning Framework" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Genesis Deep Learning Framework </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Memory Allocator Optimization </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/phonism/genesis title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> genesis </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../getting-started/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../tutorials/ class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=../core-components/ class=md-tabs__link> Core Components </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../architecture/ class=md-tabs__link> Architecture </a> </li> <li class=md-tabs__item> <a href=../models/qwen/ class=md-tabs__link> Models </a> </li> <li class=md-tabs__item> <a href=../performance/optimization-guide/ class=md-tabs__link> Performance </a> </li> <li class=md-tabs__item> <a href=../training/advanced-features/ class=md-tabs__link> Training </a> </li> <li class=md-tabs__item> <a href=../benchmark/ class=md-tabs__link> Benchmark </a> </li> <li class=md-tabs__item> <a href=../api-reference/ class=md-tabs__link> API Reference </a> </li> <li class=md-tabs__item> <a href=../contributing/ class=md-tabs__link> Contributing </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Genesis Deep Learning Framework" class="md-nav__button md-logo" aria-label="Genesis Deep Learning Framework" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Genesis Deep Learning Framework </label> <div class=md-nav__source> <a href=https://github.com/phonism/genesis title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> genesis </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../getting-started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../tutorials/ class=md-nav__link> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../core-components/ class=md-nav__link> <span class=md-ellipsis> Core Components </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5 checked> <div class="md-nav__link md-nav__container"> <a href=../architecture/ class="md-nav__link "> <span class=md-ellipsis> Architecture </span> </a> <label class="md-nav__link " for=__nav_5 id=__nav_5_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=true> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Memory Allocator Optimization </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Memory Allocator Optimization </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#background-why-is-genesis-memory-allocation-so-slow class=md-nav__link> <span class=md-ellipsis> Background: Why is Genesis Memory Allocation So Slow? </span> </a> </li> <li class=md-nav__item> <a href=#step-1-establish-performance-baseline-testing class=md-nav__link> <span class=md-ellipsis> Step 1: Establish Performance Baseline Testing </span> </a> <nav class=md-nav aria-label="Step 1: Establish Performance Baseline Testing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#design-benchmark-tests class=md-nav__link> <span class=md-ellipsis> Design Benchmark Tests </span> </a> </li> <li class=md-nav__item> <a href=#baseline-test-results class=md-nav__link> <span class=md-ellipsis> Baseline Test Results </span> </a> </li> <li class=md-nav__item> <a href=#key-findings class=md-nav__link> <span class=md-ellipsis> Key Findings </span> </a> <nav class=md-nav aria-label="Key Findings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-pytorch-caching-effect-is-amazing class=md-nav__link> <span class=md-ellipsis> 1. PyTorch Caching Effect is Amazing </span> </a> </li> <li class=md-nav__item> <a href=#2-genesis-has-no-caching class=md-nav__link> <span class=md-ellipsis> 2. Genesis Has No Caching </span> </a> </li> <li class=md-nav__item> <a href=#3-allocation-release-cycles-are-the-biggest-bottleneck class=md-nav__link> <span class=md-ellipsis> 3. Allocation-Release Cycles are the Biggest Bottleneck </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#optimization-direction-determined class=md-nav__link> <span class=md-ellipsis> Optimization Direction Determined </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#step-2-implement-simple-cache-pool class=md-nav__link> <span class=md-ellipsis> Step 2: Implement Simple Cache Pool </span> </a> <nav class=md-nav aria-label="Step 2: Implement Simple Cache Pool"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#phase-1-design-approach class=md-nav__link> <span class=md-ellipsis> Phase 1 Design Approach </span> </a> </li> <li class=md-nav__item> <a href=#core-implementation class=md-nav__link> <span class=md-ellipsis> Core Implementation </span> </a> </li> <li class=md-nav__item> <a href=#phase-1-optimization-results class=md-nav__link> <span class=md-ellipsis> Phase 1 Optimization Results </span> </a> <nav class=md-nav aria-label="Phase 1 Optimization Results"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#performance-results class=md-nav__link> <span class=md-ellipsis> Performance Results </span> </a> </li> <li class=md-nav__item> <a href=#scenario-analysis class=md-nav__link> <span class=md-ellipsis> Scenario Analysis </span> </a> </li> <li class=md-nav__item> <a href=#main-findings class=md-nav__link> <span class=md-ellipsis> Main Findings </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#step-2-next-phase-optimization-plan class=md-nav__link> <span class=md-ellipsis> Step 2: Next Phase Optimization Plan </span> </a> <nav class=md-nav aria-label="Step 2: Next Phase Optimization Plan"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#core-problem-diagnosis class=md-nav__link> <span class=md-ellipsis> Core Problem Diagnosis </span> </a> </li> <li class=md-nav__item> <a href=#phase-2-optimization-plan-size-bucket-caching class=md-nav__link> <span class=md-ellipsis> Phase 2 Optimization Plan: Size Bucket Caching </span> </a> </li> <li class=md-nav__item> <a href=#implementation-plan class=md-nav__link> <span class=md-ellipsis> Implementation Plan </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#phase-2-implementation-size-bucket-cache-optimization class=md-nav__link> <span class=md-ellipsis> Phase 2 Implementation: Size Bucket Cache Optimization </span> </a> <nav class=md-nav aria-label="Phase 2 Implementation: Size Bucket Cache Optimization"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#core-improvements class=md-nav__link> <span class=md-ellipsis> Core Improvements </span> </a> </li> <li class=md-nav__item> <a href=#implementation-results class=md-nav__link> <span class=md-ellipsis> Implementation Results </span> </a> <nav class=md-nav aria-label="Implementation Results"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overall-performance-comparison class=md-nav__link> <span class=md-ellipsis> Overall Performance Comparison </span> </a> </li> <li class=md-nav__item> <a href=#per-scenario-performance-changes class=md-nav__link> <span class=md-ellipsis> Per-scenario Performance Changes </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#phase-2-technical-assessment class=md-nav__link> <span class=md-ellipsis> Phase 2 Technical Assessment </span> </a> </li> <li class=md-nav__item> <a href=#transformer-scenario-bottleneck-root-cause-analysis class=md-nav__link> <span class=md-ellipsis> Transformer Scenario Bottleneck Root Cause Analysis </span> </a> <nav class=md-nav aria-label="Transformer Scenario Bottleneck Root Cause Analysis"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#large-tensors-exceed-bucket-limits class=md-nav__link> <span class=md-ellipsis> Large Tensors Exceed Bucket Limits </span> </a> </li> <li class=md-nav__item> <a href=#architectural-level-differences class=md-nav__link> <span class=md-ellipsis> Architectural-level Differences </span> </a> </li> <li class=md-nav__item> <a href=#performance-bottleneck-truth class=md-nav__link> <span class=md-ellipsis> Performance Bottleneck Truth </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#phase-3-implementation-block-allocator class=md-nav__link> <span class=md-ellipsis> Phase 3 Implementation: Block Allocator </span> </a> <nav class=md-nav aria-label="Phase 3 Implementation: Block Allocator"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#core-design class=md-nav__link> <span class=md-ellipsis> Core Design </span> </a> </li> <li class=md-nav__item> <a href=#implementation-results_1 class=md-nav__link> <span class=md-ellipsis> Implementation Results </span> </a> <nav class=md-nav aria-label="Implementation Results"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#overall-performance-comparison_1 class=md-nav__link> <span class=md-ellipsis> Overall Performance Comparison </span> </a> </li> <li class=md-nav__item> <a href=#major-breakthroughs-in-key-scenarios class=md-nav__link> <span class=md-ellipsis> Major Breakthroughs in Key Scenarios </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#technical-achievements class=md-nav__link> <span class=md-ellipsis> Technical Achievements </span> </a> </li> <li class=md-nav__item> <a href=#phase-3-assessment class=md-nav__link> <span class=md-ellipsis> Phase 3 Assessment </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#optimization-journey-summary class=md-nav__link> <span class=md-ellipsis> Optimization Journey Summary </span> </a> <nav class=md-nav aria-label="Optimization Journey Summary"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#progressive-improvements-in-three-phases class=md-nav__link> <span class=md-ellipsis> Progressive Improvements in Three Phases </span> </a> </li> <li class=md-nav__item> <a href=#technical-route-correctness-validation class=md-nav__link> <span class=md-ellipsis> Technical Route Correctness Validation </span> </a> </li> <li class=md-nav__item> <a href=#practical-value class=md-nav__link> <span class=md-ellipsis> Practical Value </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../models/qwen/ class=md-nav__link> <span class=md-ellipsis> Models </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../performance/optimization-guide/ class=md-nav__link> <span class=md-ellipsis> Performance </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../training/advanced-features/ class=md-nav__link> <span class=md-ellipsis> Training </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../benchmark/ class=md-nav__link> <span class=md-ellipsis> Benchmark </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../api-reference/ class=md-nav__link> <span class=md-ellipsis> API Reference </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/phonism/genesis/edit/main/docs/memory-allocator-optimization.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/phonism/genesis/raw/main/docs/memory-allocator-optimization.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1 id=genesis-gpu-memory-allocator-performance-optimization-journey>Genesis GPU Memory Allocator Performance Optimization Journey<a class=headerlink href=#genesis-gpu-memory-allocator-performance-optimization-journey title="Permanent link">&para;</a></h1> <blockquote> <p>A complete technical blog documenting the performance optimization process of Genesis deep learning framework's GPU memory allocator, from problem discovery to progressive solutions</p> </blockquote> <h2 id=background-why-is-genesis-memory-allocation-so-slow>Background: Why is Genesis Memory Allocation So Slow?<a class=headerlink href=#background-why-is-genesis-memory-allocation-so-slow title="Permanent link">&para;</a></h2> <p>When using our self-developed Genesis deep learning framework, we discovered a serious performance issue: GPU memory allocation was much slower than PyTorch. Comparative testing revealed:</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>CUDAStorage allocation vs PyTorch:
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>- 1K elements:   Genesis 0.58x PyTorch (42% slower)
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>- 10K elements:  Genesis 0.75x PyTorch (25% slower) 
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>- 100K elements: Genesis 0.42x PyTorch (58% slower)
</span></code></pre></div> <p>Even more shocking was the <code>fill_</code> operation performance:</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>Fill operation (before optimization):
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>- 512×512:   Genesis 0.10x PyTorch (10x slower!)
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>- 1024×1024: Genesis 0.03x PyTorch (33x slower!)
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>- 2048×2048: Genesis 0.01x PyTorch (100x slower!)
</span></code></pre></div> <p>This was clearly unacceptable. We needed to deeply analyze the problem and develop an optimization strategy.</p> <h2 id=step-1-establish-performance-baseline-testing>Step 1: Establish Performance Baseline Testing<a class=headerlink href=#step-1-establish-performance-baseline-testing title="Permanent link">&para;</a></h2> <p>Any optimization must first establish accurate baseline testing. We needed to understand: 1. How slow is current allocation performance exactly? 2. Which allocation patterns are performance bottlenecks? 3. What are the specific gaps compared to PyTorch?</p> <h3 id=design-benchmark-tests>Design Benchmark Tests<a class=headerlink href=#design-benchmark-tests title="Permanent link">&para;</a></h3> <p>I created a dedicated memory manager benchmark tool <code>benchmark/bench_memory_manager.py</code>, testing the following key patterns:</p> <ol> <li><strong>Same-size Repeated Allocation</strong> - Simulate training loops</li> <li><strong>Allocation-Release Cycles</strong> - Test memory reuse capability </li> <li><strong>Variable-size Allocation</strong> - Simulate batch size changes</li> <li><strong>Large Memory Allocation</strong> - Test large block memory behavior</li> <li><strong>PyTorch Cache Analysis</strong> - Deep understanding of PyTorch's caching mechanism</li> </ol> <h3 id=baseline-test-results>Baseline Test Results<a class=headerlink href=#baseline-test-results title="Permanent link">&para;</a></h3> <p>After running tests, the results were shocking:</p> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>🔴 Overall Performance Statistics:
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>- Average speedup ratio: 0.16x (Genesis 6x slower than PyTorch!)
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>- Worst speedup ratio: 0.02x (allocation-release cycles 50x slower!)
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>- Best speedup ratio: 0.38x (still 2.6x slower)
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>📊 By Pattern Category:
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>- Same-size repeated allocation:    0.22x (poor)
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>- Allocation-release cycles:        0.02x (severe!)  
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>- Variable-size allocation:         0.12x (severe)
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a>- Large memory allocation:          0.20x (poor)
</span></code></pre></div> <h3 id=key-findings>Key Findings<a class=headerlink href=#key-findings title="Permanent link">&para;</a></h3> <h4 id=1-pytorch-caching-effect-is-amazing>1. <strong>PyTorch Caching Effect is Amazing</strong><a class=headerlink href=#1-pytorch-caching-effect-is-amazing title="Permanent link">&para;</a></h4> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>PyTorch 1024×1024 allocation behavior:
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>- First allocation (cold start): 0.458ms
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>- Second allocation (cache hit): 0.021ms  
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>- Cache speedup ratio: 22x!
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>10 consecutive allocations:
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>- PyTorch average: 0.015ms 
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>- Genesis average: 0.925ms
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>- Steady-state performance gap: 62x!
</span></code></pre></div> <h4 id=2-genesis-has-no-caching>2. <strong>Genesis Has No Caching</strong><a class=headerlink href=#2-genesis-has-no-caching title="Permanent link">&para;</a></h4> <p>Genesis allocation time is consistently similar (0.9-1.0ms), indicating it indeed calls <code>cudaMalloc</code> every time with no caching mechanism.</p> <h4 id=3-allocation-release-cycles-are-the-biggest-bottleneck>3. <strong>Allocation-Release Cycles are the Biggest Bottleneck</strong><a class=headerlink href=#3-allocation-release-cycles-are-the-biggest-bottleneck title="Permanent link">&para;</a></h4> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a>Allocation-release cycle performance (20 cycles):
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>- 1024×1024: PyTorch 0.149ms vs Genesis 5.116ms (34x slower!)
</span></code></pre></div> <p>This confirmed expert analysis: <code>cudaFree</code>'s implicit synchronization severely impacts performance.</p> <h3 id=optimization-direction-determined>Optimization Direction Determined<a class=headerlink href=#optimization-direction-determined title="Permanent link">&para;</a></h3> <p>Based on test results, our optimization priorities are very clear:</p> <ol> <li><strong>🔴 Urgent</strong>: Implement basic cache pool to solve repeated <code>cudaMalloc/cudaFree</code> issues</li> <li><strong>🟠 Important</strong>: Optimize memory reuse strategy, especially allocation-release cycles</li> <li><strong>🟡 Improvement</strong>: Handle variable-size allocation patterns</li> </ol> <p>Now let's start Phase 1 optimization.</p> <h2 id=step-2-implement-simple-cache-pool>Step 2: Implement Simple Cache Pool<a class=headerlink href=#step-2-implement-simple-cache-pool title="Permanent link">&para;</a></h2> <p>Based on baseline test discoveries, we first implement a simple memory cache pool to avoid frequent <code>cudaMalloc/cudaFree</code> calls.</p> <h3 id=phase-1-design-approach>Phase 1 Design Approach<a class=headerlink href=#phase-1-design-approach title="Permanent link">&para;</a></h3> <p>I implemented a minimal viable cache allocator with the following features:</p> <ol> <li><strong>512B Alignment</strong>: All allocations aligned to 512-byte boundaries</li> <li><strong>Exact Size Matching</strong>: Cache by exact size to avoid memory waste</li> <li><strong>Simple Free List</strong>: Use <code>defaultdict(list)</code> to implement size -&gt; [ptr_list] mapping</li> <li><strong>Immediate Recycling</strong>: Return to cache immediately upon release (if cache not full)</li> <li><strong>Single Stream Friendly</strong>: Current version doesn't handle cross-stream, focuses on validating cache effect</li> </ol> <h3 id=core-implementation>Core Implementation<a class=headerlink href=#core-implementation title="Permanent link">&para;</a></h3> <div class="language-python highlight"><span class=filename>Python</span><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=k>class</span><span class=w> </span><span class=nc>CUDAMemoryManager</span><span class=p>:</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>        <span class=c1># Phase 1: Simple caching allocator</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>        <span class=bp>self</span><span class=o>.</span><span class=n>free_blocks</span> <span class=o>=</span> <span class=n>defaultdict</span><span class=p>(</span><span class=nb>list</span><span class=p>)</span>  <span class=c1># size -&gt; [ptr_list] </span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>        <span class=bp>self</span><span class=o>.</span><span class=n>active_blocks</span> <span class=o>=</span> <span class=p>{}</span>  <span class=c1># ptr -&gt; size</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>        <span class=bp>self</span><span class=o>.</span><span class=n>alignment</span> <span class=o>=</span> <span class=mi>512</span>  <span class=c1># 512B alignment</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>        <span class=bp>self</span><span class=o>.</span><span class=n>max_cache_size</span> <span class=o>=</span> <span class=mi>1024</span> <span class=o>*</span> <span class=mi>1024</span> <span class=o>*</span> <span class=mi>1024</span>  <span class=c1># 1GB cache limit</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a>    <span class=k>def</span><span class=w> </span><span class=nf>allocate</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>nbytes</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>stream</span><span class=o>=</span><span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a>        <span class=n>aligned_size</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_round_up</span><span class=p>(</span><span class=n>nbytes</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>alignment</span><span class=p>)</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>        <span class=c1># Try cache first</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>free_blocks</span><span class=p>[</span><span class=n>aligned_size</span><span class=p>]:</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>            <span class=n>ptr</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>free_blocks</span><span class=p>[</span><span class=n>aligned_size</span><span class=p>]</span><span class=o>.</span><span class=n>pop</span><span class=p>()</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>            <span class=bp>self</span><span class=o>.</span><span class=n>cache_hits</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>            <span class=k>return</span> <span class=n>ptr</span>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a>        <span class=c1># Cache miss - allocate from CUDA</span>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>        <span class=n>ptr</span> <span class=o>=</span> <span class=n>cuda</span><span class=o>.</span><span class=n>cuMemAlloc</span><span class=p>(</span><span class=n>aligned_size</span><span class=p>)</span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a>        <span class=bp>self</span><span class=o>.</span><span class=n>cache_misses</span> <span class=o>+=</span> <span class=mi>1</span>
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a>        <span class=k>return</span> <span class=n>ptr</span>
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a>    <span class=k>def</span><span class=w> </span><span class=nf>free</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>ptr</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span> <span class=n>stream</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a>        <span class=n>size</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>active_blocks</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=n>ptr</span><span class=p>)</span>
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a>        <span class=c1># Return to cache if not full</span>
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>current_cache_size</span> <span class=o>+</span> <span class=n>size</span> <span class=o>&lt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_cache_size</span><span class=p>:</span>
</span><span id=__span-5-28><a id=__codelineno-5-28 name=__codelineno-5-28 href=#__codelineno-5-28></a>            <span class=bp>self</span><span class=o>.</span><span class=n>free_blocks</span><span class=p>[</span><span class=n>size</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>ptr</span><span class=p>)</span>
</span><span id=__span-5-29><a id=__codelineno-5-29 name=__codelineno-5-29 href=#__codelineno-5-29></a>            <span class=k>return</span>
</span><span id=__span-5-30><a id=__codelineno-5-30 name=__codelineno-5-30 href=#__codelineno-5-30></a>
</span><span id=__span-5-31><a id=__codelineno-5-31 name=__codelineno-5-31 href=#__codelineno-5-31></a>        <span class=c1># Cache full - actually free</span>
</span><span id=__span-5-32><a id=__codelineno-5-32 name=__codelineno-5-32 href=#__codelineno-5-32></a>        <span class=n>cuda</span><span class=o>.</span><span class=n>cuMemFree</span><span class=p>(</span><span class=n>ptr</span><span class=p>)</span>
</span></code></pre></div> <h3 id=phase-1-optimization-results>Phase 1 Optimization Results<a class=headerlink href=#phase-1-optimization-results title="Permanent link">&para;</a></h3> <p>Simple cache allocator benchmark results:</p> <h4 id=performance-results><strong>Performance Results</strong><a class=headerlink href=#performance-results title="Permanent link">&para;</a></h4> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a>Average speedup ratio: 0.98x
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>Median speedup ratio: 0.65x  
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>Performance range: 0.03x ~ 2.85x
</span></code></pre></div> <h4 id=scenario-analysis><strong>Scenario Analysis</strong><a class=headerlink href=#scenario-analysis title="Permanent link">&para;</a></h4> <p><strong>Well-performing scenarios:</strong> - Same-size repeated allocation: 1.43x - Large memory allocation: 1.29x<br> - Inference dynamic batches: 1.01x</p> <p><strong>Average-performing scenarios:</strong> - Allocation-release cycles: 0.84x - Variable-size allocation: 0.51x</p> <p><strong>Poorly-performing scenarios:</strong> - Transformer training: 0.04x - Gradient accumulation: 0.03x - Memory pressure: 0.08x</p> <h4 id=main-findings><strong>Main Findings</strong><a class=headerlink href=#main-findings title="Permanent link">&para;</a></h4> <p><strong>Cache mechanism validation:</strong> - Exact size matching is effective for repeated allocation scenarios - Large allocations (≥100K elements) average 1.20x - Small allocations (&lt;100K elements) only 0.46x, becoming performance bottleneck</p> <p><strong>Limitations:</strong> - Low cache hit rate in complex scenarios - Exact matching strategy unsuitable for diverse memory patterns - Need more flexible caching strategies</p> <h2 id=step-2-next-phase-optimization-plan>Step 2: Next Phase Optimization Plan<a class=headerlink href=#step-2-next-phase-optimization-plan title="Permanent link">&para;</a></h2> <p>Based on Phase 1 results analysis, determine optimization priorities:</p> <h3 id=core-problem-diagnosis><strong>Core Problem Diagnosis</strong><a class=headerlink href=#core-problem-diagnosis title="Permanent link">&para;</a></h3> <ol> <li><strong>Poor small allocation performance</strong>: &lt;100K element scenarios drag down overall performance</li> <li><strong>Complex scenario failures</strong>: Extremely low cache hit rates in diverse memory patterns</li> <li><strong>Exact matching limitations</strong>: Current strategy unsuitable for scenarios with large size variations</li> </ol> <h3 id=phase-2-optimization-plan-size-bucket-caching><strong>Phase 2 Optimization Plan: Size Bucket Caching</strong><a class=headerlink href=#phase-2-optimization-plan-size-bucket-caching title="Permanent link">&para;</a></h3> <p><strong>Goal</strong>: Improve cache hit rate, solve variable-size allocation issues</p> <p><strong>Core improvements</strong>: - Change exact matching to bucket matching (like 64B, 128B, 256B, 512B...) - Reduce memory fragmentation, improve reuse rate - Prioritize solving small allocation performance issues</p> <p><strong>Expected effects</strong>: - Variable-size allocation from 0.51x to 0.8x+ - Complex scenario performance improvement - Overall average performance from 0.98x to 1.2x+</p> <h3 id=implementation-plan><strong>Implementation Plan</strong><a class=headerlink href=#implementation-plan title="Permanent link">&para;</a></h3> <ol> <li>Design bucket size strategy (powers of 2 vs fixed steps)</li> <li>Implement bucket matching allocation logic</li> <li>Benchmark test to verify effects</li> <li>Based on results, decide whether to proceed to Phase 3 (block allocator)</li> </ol> <p>Current Phase 1 has established a stable foundation, can begin Phase 2 development.</p> <h2 id=phase-2-implementation-size-bucket-cache-optimization>Phase 2 Implementation: Size Bucket Cache Optimization<a class=headerlink href=#phase-2-implementation-size-bucket-cache-optimization title="Permanent link">&para;</a></h2> <h3 id=core-improvements><strong>Core Improvements</strong><a class=headerlink href=#core-improvements title="Permanent link">&para;</a></h3> <p>Changed exact size matching to bucket matching strategy: - Use powers of 2 buckets: 512B, 1KB, 2KB, 4KB... - Maximum bucket limit 16MB, use exact alignment beyond - Improve cache hit rate for variable-size scenarios</p> <h3 id=implementation-results><strong>Implementation Results</strong><a class=headerlink href=#implementation-results title="Permanent link">&para;</a></h3> <h4 id=overall-performance-comparison><strong>Overall Performance Comparison</strong><a class=headerlink href=#overall-performance-comparison title="Permanent link">&para;</a></h4> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>Phase 1 → Phase 2:
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>Average speedup ratio: 0.98x → 0.97x (slight decrease)
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>Median speedup ratio: 0.65x → 0.88x (significant improvement +35%)
</span></code></pre></div> <h4 id=per-scenario-performance-changes><strong>Per-scenario Performance Changes</strong><a class=headerlink href=#per-scenario-performance-changes title="Permanent link">&para;</a></h4> <p><strong>Significantly improved scenarios:</strong> - Variable-size allocation: 0.51x → 0.83x (+63%) - Memory pressure: 0.08x → 1.48x (+1750%)<br> - Inference dynamic batches: 1.01x → 1.40x (+39%) - Allocation-release cycles: 0.84x → 1.01x (+20%)</p> <p><strong>Performance decline scenarios:</strong> - Same-size repeated allocation: 1.43x → 0.90x (-37%)</p> <p><strong>Still severe bottlenecks:</strong> - Transformer training: 0.04x → 0.05x (almost no improvement) - Gradient accumulation: 0.03x → 0.07x (minor improvement)</p> <h3 id=phase-2-technical-assessment><strong>Phase 2 Technical Assessment</strong><a class=headerlink href=#phase-2-technical-assessment title="Permanent link">&para;</a></h3> <p><strong>Successfully validated:</strong> - Bucket matching effectively improved cache hit rate for variable-size scenarios - Large median performance improvement shows most scenarios benefited - Breakthrough in memory pressure scenarios proves value of bucket caching</p> <p><strong>Problems discovered:</strong> - Bucket caching introduces memory waste, affecting same-size allocation performance - Complex training scenarios (Transformer/gradient accumulation) still not fundamentally improved - Need deeper optimization strategies to solve core bottlenecks</p> <h3 id=transformer-scenario-bottleneck-root-cause-analysis><strong>Transformer Scenario Bottleneck Root Cause Analysis</strong><a class=headerlink href=#transformer-scenario-bottleneck-root-cause-analysis title="Permanent link">&para;</a></h3> <p>Through deep analysis, found fundamental reasons why bucket caching is ineffective for complex training scenarios:</p> <h4 id=large-tensors-exceed-bucket-limits><strong>Large Tensors Exceed Bucket Limits</strong><a class=headerlink href=#large-tensors-exceed-bucket-limits title="Permanent link">&para;</a></h4> <ul> <li>Logits tensors reach 78MB-313MB, far exceeding 16MB bucket limit</li> <li>Ultra-large tensors fall back to exact alignment, cannot enjoy bucket caching advantages</li> <li>Frequent large memory cudaMalloc calls become main overhead</li> </ul> <h4 id=architectural-level-differences><strong>Architectural-level Differences</strong><a class=headerlink href=#architectural-level-differences title="Permanent link">&para;</a></h4> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a>PyTorch block allocator advantages:
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>- Pre-allocate large memory pools (512MB-2GB)
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>- Slice tensors from memory pool, avoiding cudaMalloc
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>- Return to pool upon release, achieving true zero-overhead reuse
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>Genesis bucket cache limitations:
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>- Each tensor still needs independent cudaMalloc
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>- Cannot utilize fundamental advantages of memory pools
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>- Large tensors completely bypass caching mechanism
</span></code></pre></div> <h4 id=performance-bottleneck-truth><strong>Performance Bottleneck Truth</strong><a class=headerlink href=#performance-bottleneck-truth title="Permanent link">&para;</a></h4> <ul> <li>60 tensors, mostly 4MB-320MB level</li> <li>cudaMalloc system call overhead for large memory blocks is huge</li> <li>No matter how high cache hit rate, cannot mask fundamental architectural issues</li> </ul> <p><strong>Conclusion</strong>: Bucket caching is incremental improvement but cannot solve fundamental problems of large-scale training. Need to implement PyTorch-style block allocator to truly break through performance bottlenecks.</p> <h2 id=phase-3-implementation-block-allocator>Phase 3 Implementation: Block Allocator<a class=headerlink href=#phase-3-implementation-block-allocator title="Permanent link">&para;</a></h2> <h3 id=core-design><strong>Core Design</strong><a class=headerlink href=#core-design title="Permanent link">&para;</a></h3> <p>Implement PyTorch-style block allocator to solve fundamental performance issues of large memory allocation: - Pre-allocate large memory segments (1GB) as memory pool - Use best-fit algorithm to slice blocks from pool - Return to pool upon release, support block merging to reduce fragmentation - Layered architecture: &lt;1MB use bucket cache, ≥1MB use block allocator</p> <h3 id=implementation-results_1><strong>Implementation Results</strong><a class=headerlink href=#implementation-results_1 title="Permanent link">&para;</a></h3> <h4 id=overall-performance-comparison_1><strong>Overall Performance Comparison</strong><a class=headerlink href=#overall-performance-comparison_1 title="Permanent link">&para;</a></h4> <div class="language-text highlight"><span class=filename>Text Only</span><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a>Phase 2 → Phase 3:
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>Average speedup ratio: 0.97x → 1.41x (+45% improvement)
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>Median speedup ratio: 0.88x → 0.81x (slight decrease)
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>Best performance: 2.60x → 4.83x (new performance peak)
</span></code></pre></div> <h4 id=major-breakthroughs-in-key-scenarios><strong>Major Breakthroughs in Key Scenarios</strong><a class=headerlink href=#major-breakthroughs-in-key-scenarios title="Permanent link">&para;</a></h4> <p><strong>Dramatically improved scenarios:</strong> - Transformer training: 0.05x → 1.89x (+3680%, from severe bottleneck to surpassing PyTorch) - Large memory allocation: 1.29x → 3.92x (+204%, significantly better than PyTorch) - Large-size repeated allocation: from Phase 1's 0.27x to Phase 3's 2.31x</p> <p><strong>Stable scenarios:</strong> - Small allocation scenarios basically maintain original levels - Practical scenarios like inference services perform stably</p> <p><strong>Still need improvement scenarios:</strong> - Gradient accumulation: 0.07x → 0.18x (improved but still poor) - Variable-size allocation: 0.83x → 0.34x (affected by layered strategy)</p> <h3 id=technical-achievements><strong>Technical Achievements</strong><a class=headerlink href=#technical-achievements title="Permanent link">&para;</a></h3> <p><strong>Successfully solved core problems:</strong> - Completely eliminated cudaMalloc system call overhead in large allocation scenarios - Achieved true memory pool reuse mechanism - Validated effectiveness of block allocator architecture</p> <p><strong>Technical architecture success:</strong> - Layered allocation strategy works properly - Good utilization rate of 1GB memory segments - Best-fit algorithm and block merging mechanism effective</p> <p><strong>Limitation recognition:</strong> - Small allocation scenarios still have room for improvement - Some special scenarios (like gradient accumulation) need further tuning - Compared to mature PyTorch, still gaps in some specific scenarios</p> <h3 id=phase-3-assessment><strong>Phase 3 Assessment</strong><a class=headerlink href=#phase-3-assessment title="Permanent link">&para;</a></h3> <p>Block Allocator successfully solved the most critical large memory allocation bottleneck, enabling Genesis to achieve or even surpass PyTorch performance in important scenarios. While not all scenarios are perfect, it has transformed from "severely lagging" to "basically usable, leading in some scenarios."</p> <p>This establishes a solid foundation for Genesis applications in actual deep learning tasks.</p> <h2 id=optimization-journey-summary>Optimization Journey Summary<a class=headerlink href=#optimization-journey-summary title="Permanent link">&para;</a></h2> <p>From initial "catastrophic performance" (0.02x) to current "overall leading" (1.41x), this memory allocator optimization achieved substantial breakthroughs:</p> <h3 id=progressive-improvements-in-three-phases><strong>Progressive Improvements in Three Phases</strong><a class=headerlink href=#progressive-improvements-in-three-phases title="Permanent link">&para;</a></h3> <ul> <li><strong>Phase 1</strong>: Solved most basic memory reuse issues, established optimization foundation</li> <li><strong>Phase 2</strong>: Improved cache hit rate for variable-size scenarios, enhanced median performance </li> <li><strong>Phase 3</strong>: Completely solved large memory allocation bottlenecks, achieved qualitative leap</li> </ul> <h3 id=technical-route-correctness-validation><strong>Technical Route Correctness Validation</strong><a class=headerlink href=#technical-route-correctness-validation title="Permanent link">&para;</a></h3> <p>Through systematic benchmark testing and root cause analysis, we accurately identified performance bottlenecks and chose correct technical solutions. Each phase had clear goals and measurable results.</p> <h3 id=practical-value><strong>Practical Value</strong><a class=headerlink href=#practical-value title="Permanent link">&para;</a></h3> <p>Genesis can now provide acceptable memory allocation performance in most practical scenarios, particularly competitive in critical scenarios like large-scale model training.</p> <p>Of course, this is only a phase result in memory management optimization. Future could consider more optimization directions, such as multi-stream concurrency, NUMA awareness, or specialized optimizations for specific models.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime" title="August 21, 2025 01:58:40 UTC">2025-08-21 01:58:40</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime" title="August 21, 2025 01:58:40 UTC">2025-08-21 01:58:40</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../architecture/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Overview"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Overview </div> </div> </a> <a href=../models/qwen/ class="md-footer__link md-footer__link--next" aria-label="Next: Qwen Model"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Qwen Model </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 Genesis Team </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/phonism/genesis target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://pypi.org/project/genesis-dl/ target=_blank rel=noopener title=pypi.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <div class=md-consent data-md-component=consent id=__consent hidden> <div class=md-consent__overlay></div> <aside class=md-consent__inner> <form class="md-consent__form md-grid md-typeset" name=consent> <h4>Cookie consent</h4> <p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p> <input class=md-toggle type=checkbox id=__settings> <div class=md-consent__settings> <ul class=task-list> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=analytics checked> <span class=task-list-indicator></span> Google Analytics </label> </li> <li class=task-list-item> <label class=task-list-control> <input type=checkbox name=github checked> <span class=task-list-indicator></span> GitHub </label> </li> </ul> </div> <div class=md-consent__controls> <button class="md-button md-button--primary">Accept</button> <label class=md-button for=__settings>Manage settings</label> </div> </form> </aside> </div> <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script> <script id=__config type=application/json>{"base": "..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.tooltips", "header.autohide", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.path", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../assets/javascripts/bundle.50899def.min.js></script> <script src=../../shared/javascripts/mathjax.js></script> <script src=../../shared/javascripts/i18n.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> </body> </html>